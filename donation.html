<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <span id="address"></span>
    <span id="balance"></span>
    <button id="refreshBalance">refresh balance</button>
    <input type="number" id="amount" /> <button id="donate">Donate</button>
    <script type="module">
        import { ethers } from "./ethers.esm.min.js"
        const provider = new ethers.providers.JsonRpcProvider(
            "http://localhost:8545"
        );
        const wallet = ethers.Wallet.createRandom().connect(provider)

        async function main() {
            let walletEl = document.getElementById('address')
            let balanceEl = document.getElementById('balance')
            const signer = provider.getSigner(0);
            const tx = {
                to: wallet.address,
                value: ethers.utils.parseEther("100"),
            };
            try {
                const txRes = await signer.sendTransaction(tx);
                await txRes.wait();
            } catch (e) {
                console.log(e);
            }
            walletEl.textContent = wallet.address
            const balance = await provider.getBalance(wallet.address)
            balanceEl.textContent = ethers.utils.formatEther(balance)
            document.getElementById('refreshBalance').addEventListener('click', refreshBalance)
            document.getElementById('donate').addEventListener('click', donate)
        }

        main()

        async function donate() {
            const amount = document.getElementById('amount').value
            const tx = {
                to: "0x837F324FF70AD9AE4B71084c941c23dDF8371d60",
                value: ethers.utils.parseEther(amount)
            }
            const txRes = await wallet.sendTransaction(tx)
            await txRes.wait()
        }

        async function refreshBalance() {
            let address = document.getElementById('address')
            const newBalance = await provider.getBalance(address.textContent)
            document.getElementById('balance').textContent =
                ethers.utils.formatEther(newBalance);

        }
    </script>

</body>

</html>